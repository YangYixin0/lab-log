# WebSocket MJPEG 服务器

## 功能说明

此Python WebSocket服务器：
- 监听 `0.0.0.0:50001` 端口
- 接收Arduino发送的摄像头MJPEG数据（JPEG二进制）
- 保存图片到 `images/` 目录
- 文件名格式：`frame_YYYYMMDD_HHMMSS_XXX.jpg`
- 最多保存200张图片，超出后自动删除最旧的
- 每秒统计并打印FPS（帧率）
- 支持通过命令行控制Arduino开始/停止采集

## 安装依赖

```bash
pip install -r requirements.txt
```

## 运行服务器

```bash
python server.py
```

服务器启动后会：
- 显示监听地址和配置信息
- 等待Arduino客户端连接
- 接收并保存摄像头帧
- 每秒打印FPS统计信息

## 输出示例

```
[2025-11-16 14:30:25] 启动WebSocket服务器...
[2025-11-16 14:30:25] 监听地址: 0.0.0.0:50001
[2025-11-16 14:30:25] 图片保存路径: /path/to/backend/images
[2025-11-16 14:30:25] 最多保存图片数: 200
[2025-11-16 14:30:25] 等待客户端连接...
------------------------------------------------------------
[2025-11-16 14:30:30] 新客户端连接: 192.168.1.100:54321
[2025-11-16 14:30:31] FPS: 2.50 (总帧数: 3)
[2025-11-16 14:30:32] FPS: 2.30 (总帧数: 8)
...
```

## 图片存储

- **存储路径**：`backend/images/`
- **文件命名**：`frame_YYYYMMDD_HHMMSS_XXX.jpg`
  - `YYYYMMDD`：日期
  - `HHMMSS`：时间
  - `XXX`：帧序号（3位数字）
- **存储限制**：最多200张，超出后自动删除最旧的图片

## 控制命令

服务器启动后，可以在终端输入以下命令控制Arduino：

- `start` - 开始采集和上传摄像头数据
- `stop` - 停止采集和上传
- `status` - 查询Arduino当前状态（采集中/已停止）
- `help` - 显示帮助信息
- `quit` 或 `exit` - 退出程序

### 使用示例

```
[2025-11-16 14:30:30] 新客户端连接: 192.168.1.100:54321
[2025-11-16 14:30:30] 可以使用以下命令控制采集:
  start  - 开始采集
  stop   - 停止采集
  status - 查询状态
  help   - 显示帮助

start
[2025-11-16 14:30:35] 已发送命令: start
[2025-11-16 14:30:35] Arduino响应: ACK: 开始采集
[2025-11-16 14:30:36] FPS: 2.50 (总帧数: 3)
[2025-11-16 14:30:37] FPS: 2.30 (总帧数: 8)

stop
[2025-11-16 14:30:40] 已发送命令: stop
[2025-11-16 14:30:40] Arduino响应: ACK: 停止采集
```

## 停止服务器

按 `Ctrl+C` 或输入 `quit` 停止服务器。停止时会显示总共接收的帧数。
